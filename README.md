# framework
php фреймворк основанный на паттерне command (php framework based on the pattern of command)

Небольшой php фреймворк в основе которого лежит паттерн проектирования команда.

Фреймворк спроектирован на основе паттерна проектирования MVC.
Для создания моделей используется шаблон проектирования Domain Model.
Для реализации команд используется шаблон Command, точка входа в приложение является инициализатором.
Представления реализованы через подключаемые шаблоны Smarty.

На вход инициализатора (init.php) поступает команда из адресной строки (инициализатор задает настройки: подключение к БД(config.xml), настройки шаблонов смарти, настройки каманды). Параллельно подгружаются Smarty, DB. Command подключает модуль авторизации. Класс router находит команду, соответствующую адресной строке, если такой команды нет, отправляет на дефолтную команду. Характеристики команд находится в route.xml.  После чего выполняются команды (вывод формы авторизации, обработчик формы, если это дефолтная команда, то отображение индекса).  Настройки для команд и конфигурация (системные настройки) хранятся в отдельных XML - файлах.
База данных (БД) - множество данных, обрабатываемых определенным образом.
Smarty – шаблонизатор, позволяющий отделить логику приложения от отображения (представления).
Config.xml-название хоста для БД, название БД.
Route.xml- характеристики команд, каким типам пользователей доступна та или иная команда.


Имеются уже установленые Twitter Bootstrap, jQuery, Smarty, ЧПУ

Основные классы

1.Config.

Конфигурация сайта  — совокупность настроек сайта, задаваемая разработчиком

Файл config.xml содержит ряд узлов, разбитых на  категории –
db –параметры базы данных;
authinfo – параметр названия сайта.
В категориях содержатся следующие параметры:
dbname – название базы данных;
host – адрес сервера бд;
user – имя пользователя;
pass – пароль пользователя;
sitename – авторизационный параметр - название сайта.

Пример конфигурационного файла config.xml
<?xml version="1.0" encoding='UTF-8'?>
<config>
     	<db>
     	<dbname>imi_bsu_ru</dbname>        	
     	<host>localhost</host>
     	<user>root</user>
     	<pass>pass</pass>
     	</db>  
     	<authinfo>
     	<sitename>
               	abiturientIMI
     	</sitename>     	
     	</authinfo>
</config>

Класс Config представляет доступ к конфигурационным данным из файла config.xml. Класс заполняет ассоциативный массив данными из xml-файла  при инициализации и предоставляет доступ.
При реализации использованы шаблоны: Facade, Singleton.

2  Router
Файл route.xml содержит дерево узлов, которые указывают соответствие  URL командам и их настройкам -  представлений, подключаемым модулям и др.
Файл route.xml содержит ряд параметров  в узле route:
     	command – название команды – обработчика;             	
     	view – название файла с расширением .tpl, который отображает "середину" сайта;
onlyMainView – параметр указывается, когда не нужно подгружать хидер и футер шаблона;
css – параметр указывается, когда нужно вместо дефолтного подключить другой файл с расширением .css;
smarty - указываем если не нужно подключать Smarty;
     	db – параметр указывается, когда не нужно подключать базу данных;
session - параметр указывается, когда не нужно подключать сессии.
 Пример конфигурационного файла router.xml
<routes>	
     	<route url="default">
     	<command>DefaultCommand</command>           	
     	<view>loginPage</view>
     	<onlyMainView>1</onlyMainView>
     	<css>signin</css>
     	</route>
     	<!--Обработка формы авторизации-->  
     	<route url="auth">
     	<command>LoginProcess</command>        	
     	<smarty>1</smarty>
     	</route>
     	<!-- Команда на выход из системы-->
     	<route url="logOut">
     	<command>LogOut</command>        	
     	<smarty>1</smarty>
     	<db>1</db>
     	</route>
     	</routes>  
Описание работы
Класс Router служит для организации работы FURL. Класс находит команду соответствующую адресной строке, если такой команды нет, отправляет на дефолтную команду (Default Command).
Если же пользователь делает запрос к несуществующему файлу или к несуществующему каталогу, то этот запрос передаётся к странице по умолчанию (url=default).

3.Domain Object
Абстрактный класс для работы с объектом, является предком для всех классов моделей. В нем реализованы основные методы, необходимые для работы с объектом.



 Описание методов класса DomainObject
Метод	Описание
setId	Задает  id объекта
getId	Возвращает  id
setAuthorId	Задает авторов объекта
getAuthorId	Возвращает  авторов объекта
setDB	Задает настройки бд
insertObject	Вставляет новый объект в бд
updateObject	Обновляет объект из бд
loadObject	Загружает данные в базу данных
deleteObject	Удаляет  объект
deleteSpec	Удаляет  параметры объекта, переопределяется в дочерних классах
getObject	Возвращает  объект из базы данных по id  	
getCollection	Возвращает  коллекции объектов
setObject	Заполняет  объект данными
getArray	Заполняет все данные объекта в ассоциативный массив


4.Collection
 Класс Collection является реализацией шаблона Iterator и расширяет стандартный интерфейс Iterator, собирает в коллекции несколько объектов, упрощая работу с группой объектов.

Описание методов класса Collection
Метод	Описание
setId	Задает  id объекта
getQuantity	Возвращает  количество элементов в коллекции
add	Добавляет объект в коллекцию
getRow	Задает строки
rewind	Указатель на начало
current	Возвращает текущий элемент
key	Получает указатель
next	Возвращает следующий элемент
valid	Возвращает true, если текущий элемент не NULL

5.Command
В абстрактном классе Command определен метод doExecute, в котором подключается метод initialize класса Init, проверяется уровень доступа к команде, если пользователю доступна команда, то она исполняется и выводится шаблон Smarty, иначе он попадает на дефолтную страницу.

Описание методов класса Command

Метод	Описание
setSmarty	Задает  Smarty
setHeaderAndFooter	Задает  хидер и футер шаблона страницы
getAuth	Проверяет  права доступа пользователя
setMain	Задает  главное меню шаблона сайта
execute	Абстрактный  метод для выполнения команды, переопределяется в дочерних классах
publicPage	По умолчанию возвращает false, может быть переопределена в дочерних классах, когда не нужно вообще проверять доступ к команде
getLocation	запрещает запуск команд обработчиков форм
objectData	По умолчанию  возвращает false, может быть переопределена в дочерних классах, когда нужна проверка на доступ к объекту с которым пытается работать пользователь

6.Init
Класс является инициализатором  шаблона Command. При создании объекта Init,  находится команда соответствующая URL (при помощи класса РОУТЕР), считывается класс команды и её настройки (включается и настраивается сессия, подключается Smarty и база данных).  
В классе определен метод execute() в котором выполняется метод класса Command doExecute(). Инициализация проводится через статический метод public static function initialize($siteRoot)
Инициализатор реализован с использованием шаблона Singleton.

 Описание методов класса Init
Метод	Описание
execute	Выполнение команды
initialize	Инициализация класса
getRegistry	Возвращает объект класса Registry
getSiteRoot	Возвращает директорию сайта
getDB	Возвращает объект класса базы данных
getAuth	Возвращает объект класса Auth
getSmarty	Возвращает Smarty

7.Registry
Системный класс Registry является реализацией шаблона Singleton и предоставляет доступ к данным из сессии. В нем определены функции getValue (получение данных из сессии) и setValue(запись данных в сессию).


Описание методов класса Registry
Метод	Описание
getValue	Получает значение из сессии
setValue	Возвращает значение из сессии
getRegistry	Возвращает объект класса Registry


8.Db
Класс Db устанавливает соединение с базой данных и предоставляет методы для работы с базой данных. По сути класс Db – реализация шаблона Façade для работы с объектом PDO.


Описание методов класса Db
Метод	Описание
getDBH	Возвращает объект класса ПДО
setQuery	Задает sql запрос
Execute	Выполнение sql запроса
fetchSTH	Получение массива из запроса
getNumRow	Вернёт количество кортежей в таблице
getAllRow	Возвращает все строки запроса
insertOneRow	Вставляет все строки запроса
deleteAllRow	Удаляет все строки запроса
updateRow	Обновляет все строки запроса


9.Auth
Класс Auth  авторизует пользователей, определяет доступ пользователя к команде. При реализации использованы шаблоны: Facade, Singleton. Описание методов класса представлено.
Описание методов класса Auth

Метод	Описание
getSiteName	Получает имя сайта из config.xml
is_logged	Проверяет залогинен ли пользователь
Access	Определяет доступ к команде
objectOwner	Проверяет случай, когда пользователь имеет только свой объект
accessRigths	Если нет доступа к команде, то перенаправляет на главную страницу сайта
setUser	Задает параметры пользователя
getUser	Получает параметры пользователя
logOut	Выход пользователя из системы
defaultRedirect	По умолчанию




Структура файловой системы
/ - корневая папка.
/application/ - папка содержит исполняемые файлы (команды, представления, модели).
/system/ - папка, в которой хранятся системные классы (db, model, init, config, command, registry, auth, router).
/assets/ - папка, в которой хранятся сторонние библиотеки (Twitter Bootstrap, Smarty, JScript, Jquery, CSS).
/config/ - папка, содержащая конфигурационные файлы, такие как config.xml, routes.xml.























